<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Registro de Pagos - 2150 MXN semanal</title>
  <style>
    :root{
      --bg:#FFF8E1; /* user preferred */
      --text:#37200D;
      --accent:#FF7152;
      --white:#ffffff;
      --card:#fff7ee;
      --muted:#7a5b48;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    .app{max-width:980px;margin:28px auto;padding:18px}
    header{display:flex;gap:12px;align-items:center}
    .brand{display:flex;flex-direction:column}
    h1{margin:0;font-size:20px}
    p.lead{margin:2px 0 0;color:var(--muted)}

    .top-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(55,32,13,0.06);flex:1;min-width:220px}
    .big{font-size:20px;font-weight:700}
    .small{font-size:13px;color:var(--muted)}

    .progress-wrap{margin-top:12px}
    .progress{height:16px;background:#ffe9d9;border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#ff9b79);width:0%;transition:width 450ms ease}

    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{background:var(--accent);color:var(--white);border:none;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;color:var(--text);border:1px solid rgba(55,32,13,0.08)}

    .table{margin-top:18px;border-radius:10px;overflow:hidden}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;text-align:left}
    thead th{background:transparent;border-bottom:1px dashed rgba(55,32,13,0.08);font-size:13px;color:var(--muted)}
    tbody tr:nth-child(even){background:rgba(255,255,255,0.5)}
    .amount{font-weight:700}
    .paid{background:#e8f7ee;color:#0b6b3a;border-radius:999px;padding:6px 10px;display:inline-block}
    .not-paid{color:var(--muted)}

    .positive{color:#0b6b3a}
    .tip{font-size:13px;color:var(--muted);margin-top:8px}

    footer{margin-top:18px;color:var(--muted);font-size:13px}

    /* responsive */
    @media (max-width:720px){.top-row{flex-direction:column}.card{min-width:unset}}

    /* confetti */
    #confetti{position:fixed;left:0;top:0;right:0;bottom:0;pointer-events:none;z-index:9999}
  </style>
</head>
<body>
  <div class="app" role="main">
    <header>
      <div style="width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#ff9b79);display:flex;align-items:center;justify-content:center;color:var(--white);font-weight:800;font-size:18px">PAY</div>
      <div class="brand">
        <h1>Registro de pagos — 2,150 MXN cada lunes</h1>
        <p class="lead">Inicio: primer lunes desde el inicio de este mes · Duración: 2 años (104 pagos)</p>
      </div>
    </header>

    <div class="top-row">
      <div class="card">
        <div class="small">Objetivo total</div>
        <div class="big">$205,000 MXN</div>
        <div class="progress-wrap">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="small">Progreso</div>
            <div id="percent" class="small">0%</div>
          </div>
          <div class="progress" aria-hidden>
            <i id="bar"></i>
          </div>
          <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
            <div>
              <div class="small">Pagado</div>
              <div id="paid" class="big">$0</div>
            </div>
            <div>
              <div class="small">Falta</div>
              <div id="left" class="big">$205,000</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="small">Acciones rápidas</div>
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="markAll">Marcar todos</button>
          <button id="clearAll" class="ghost">Desmarcar todo</button>
          <button id="export" class="ghost">Exportar respaldo</button>
          <button id="importBtn" class="ghost">Importar respaldo</button>
        </div>
        <p class="tip">Sugerencia: guarda el archivo exportado en Google Drive o tu nube favorita para restaurarlo desde cualquier dispositivo.</p>
      </div>
    </div>

    <div class="card table">
      <div style="display:flex;justify-content:space-between;align-items:center;padding-bottom:8px">
        <div>
          <div class="small">Lista de pagos</div>
          <div class="tip">Toca el botón para marcar el pago. Puedes agregar la página a tu pantalla de inicio para usarla como app.</div>
        </div>
        <div>
          <div class="small">Total de pagos: <strong>104</strong></div>
        </div>
      </div>

      <table aria-label="Lista de pagos">
        <thead>
          <tr>
            <th>#</th>
            <th>Fecha (Lunes)</th>
            <th>Monto</th>
            <th>Estado</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="tbody">
          <!-- filas generadas por JS -->
        </tbody>
      </table>
    </div>

    <footer>
      <div>Hecho con ❤️ — Guarda, exporta y restaura cuando quieras.</div>
    </footer>
  </div>

  <canvas id="confetti"></canvas>

  <input id="importFile" type="file" accept="application/json" style="display:none" />

  <script>
    /* CONFIG */
    const AMOUNT = 2150;
    const TOTAL_GOAL = 205000;
    const WEEKS = 104; // 2 years
    const STORAGE_KEY = 'pagos_2150_v1';

    // helper formats
    const fmt = n => n.toLocaleString('es-MX', {style:'currency',currency:'MXN',maximumFractionDigits:0});

    function startOfMonth(date){return new Date(date.getFullYear(), date.getMonth(), 1)}

    function nextMondayOnOrAfter(d){
      const day = d.getDay(); // 0 sun .. 1 mon
      const diff = (8 - day) % 7; // days to add to get Monday (if Monday, diff=0)
      const nd = new Date(d);
      nd.setDate(d.getDate() + diff);
      nd.setHours(0,0,0,0);
      return nd;
    }

    function generateSchedule(){
      const today = new Date();
      const firstDay = startOfMonth(today);
      let current = nextMondayOnOrAfter(firstDay);
      const arr = [];
      for(let i=0;i<WEEKS;i++){
        arr.push({index:i+1,date:current.toISOString().slice(0,10),paid:false});
        current = new Date(current);
        current.setDate(current.getDate() + 7);
      }
      return arr;
    }

    // state
    let schedule = [];

    function load(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw){
        try{ const parsed = JSON.parse(raw);
          // basic compatibility check
          if(Array.isArray(parsed) && parsed.length===WEEKS && parsed[0].hasOwnProperty('date')){ schedule = parsed; return; }
        }catch(e){/* ignore */}
      }
      schedule = generateSchedule();
      save();
    }

    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(schedule)); }

    function render(){
      const tbody = document.getElementById('tbody'); tbody.innerHTML = '';
      let paidCount = 0;
      let paidSum = 0;
      schedule.forEach(item=>{
        const tr = document.createElement('tr');
        const tdNum = document.createElement('td'); tdNum.textContent = item.index;
        const tdDate = document.createElement('td'); tdDate.textContent = new Date(item.date).toLocaleDateString('es-MX',{weekday:'short',year:'numeric',month:'short',day:'numeric'});
        const tdAmt = document.createElement('td'); tdAmt.innerHTML = `<span class="amount">${fmt(AMOUNT)}</span>`;
        const tdState = document.createElement('td');
        const btn = document.createElement('button'); btn.style.borderRadius='8px'; btn.style.padding='8px 10px';
        if(item.paid){ btn.textContent = 'Pagado'; btn.className='ghost'; tdState.appendChild(btn); paidCount++; paidSum+=AMOUNT; }
        else{ btn.textContent = 'Marcar pago'; btn.className=''; tdState.appendChild(btn); }
        btn.addEventListener('click',()=>{ item.paid = !item.paid; save(); render(); if(item.paid) burstConfetti(); });
        const tdEmpty = document.createElement('td'); tdEmpty.className='small'; tdEmpty.textContent = '';
        tr.appendChild(tdNum); tr.appendChild(tdDate); tr.appendChild(tdAmt); tr.appendChild(tdState); tr.appendChild(tdEmpty);
        tbody.appendChild(tr);
      });

      // totals
      const paidEl = document.getElementById('paid'); const leftEl = document.getElementById('left'); const percentEl = document.getElementById('percent'); const bar = document.getElementById('bar');
      const paidTotal = paidSum;
      const left = Math.max(0, TOTAL_GOAL - paidTotal);
      const percent = Math.min(100, Math.round((paidTotal / TOTAL_GOAL) * 100));
      paidEl.textContent = fmt(paidTotal);
      leftEl.textContent = fmt(left);
      percentEl.textContent = percent + '%';
      bar.style.width = percent + '%';
    }

    // actions
    document.getElementById('markAll').addEventListener('click',()=>{ schedule.forEach(s=>s.paid=true); save(); render(); burstConfetti(60); });
    document.getElementById('clearAll').addEventListener('click',()=>{ schedule.forEach(s=>s.paid=false); save(); render(); });

    // export/import
    document.getElementById('export').addEventListener('click',()=>{
      const blob = new Blob([JSON.stringify(schedule)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'respaldo_pagos_2150.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    const importFile = document.getElementById('importFile');
    document.getElementById('importBtn').addEventListener('click',()=>importFile.click());
    importFile.addEventListener('change',()=>{
      const f = importFile.files[0]; if(!f) return; const reader = new FileReader();
      reader.onload = e => { try{ const parsed = JSON.parse(e.target.result); if(Array.isArray(parsed) && parsed.length===WEEKS){ schedule = parsed; save(); render(); alert('Respaldo importado correctamente'); } else { alert('Archivo inválido: revisa que sea el respaldo correcto.'); } }catch(err){ alert('No se pudo leer el archivo.'); }};
      reader.readAsText(f);
    });

    // confetti implementation (simple)
    const confettiCanvas = document.getElementById('confetti');
    confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight;
    window.addEventListener('resize',()=>{ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; });
    const ctx = confettiCanvas.getContext('2d');

    function random(min,max){return Math.random()*(max-min)+min}

    function burstConfetti(count=30){
      const pieces = [];
      for(let i=0;i<count;i++){
        pieces.push({x:random(0,confettiCanvas.width),y:random(-20,confettiCanvas.height/4),vx:random(-2,2),vy:random(1,6),w:random(6,12),h:random(8,16),rot:random(0,360),vr:random(-6,6),color:["#ff7a5a","#ffd166","#ff9b79","#ffb4a2","#fff" ][Math.floor(random(0,5))]});
      }
      let t=0;
      const anim = ()=>{
        t++; ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
        for(const p of pieces){ p.x+=p.vx; p.y+=p.vy; p.vy+=0.12; p.rot+=p.vr; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180); ctx.fillStyle=p.color; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore(); }
        if(t<200){ requestAnimationFrame(anim); } else { ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }
      };
      anim();
    }

    // initial load
    load(); render();

    // small UX tip: suggest add to home on mobile
    if(/iphone|ipad|ipod|android/i.test(navigator.userAgent)){
      console.log('Mobile device detected — puedes "Agregar a pantalla de inicio" para usar como app.');
    }
  </script>
</body>
</html>
